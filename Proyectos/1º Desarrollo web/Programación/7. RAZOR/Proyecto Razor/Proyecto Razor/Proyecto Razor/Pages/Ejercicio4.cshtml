@page "/Ejercicio4"
@model Proyecto_Razor.Pages.Ejercicio4Model
@{
    List<string> tiposPokemon = new List<string>
    {
        "Fuego",
        "Planta",
        "Agua"
    };
}

@{
    ViewData["Title"] = "Ejercicio 4 - Listas Filtradas 2";
}



@section content {
    <div>
        <form name="form03" method="post" action="">
            <fieldset>
                <legend></legend>
                <div>
                    @if (Request.Method == "POST")
                    {
                        <select id="cmbTipos" name="cmbTipos" onchange="this.form.submit()">
                            <option value="">-- Seleccionar Tipo --</option>
                            @foreach (string tipo in tiposPokemon)
                            {
                                <option value="@tipo" @((Request.Form["cmbTipos"] == tipo) ? "selected" : "")>@tipo</option>
                            }
                        </select>
                    }
                    else
                    {
                        <select id="cmbTipos" name="cmbTipos" onchange="this.form.submit()">
                            <option value="" selected>-- Seleccionar Tipo --</option>
                            @foreach (string tipo in tiposPokemon)
                            {
                                <option>@tipo</option>
                            }
                        </select>
                    }

                </div>
                @if (Request.Method == "POST")
                {
                    string tipoSeleccionado = Request.Form["cmbTipos"];
                    if (!string.IsNullOrEmpty(tipoSeleccionado) && tipoSeleccionado != "-- Seleccionar Tipo --")
                    {
                        List<string> pokemonsTipoSeleccionado = (from pokemon in Model.Datos.Pokemon
                                                                 join tipo in Model.Datos.Tipos on pokemon.IdTipo equals tipo.IdTipo
                                                                 where tipo.Nombre == tipoSeleccionado
                                                                 select pokemon.Nombre).ToList();
                        if (pokemonsTipoSeleccionado.Count > 0)
                        {
                            <div>
                                <select id="cmbPokemons" name="cmbPokemons">
                                    @foreach (string pokemon in pokemonsTipoSeleccionado)
                                    {
                                        <option value="@pokemon" @(Request.Form["cmbPokemons"] == pokemon ? "selected" : "")>@pokemon</option>
                                    }
                                </select>
                            </div>
                        }
                    }
                }
                <input type="submit" value="Enviar">
                <style>
                    table {
                        width: 100%;
                        border-collapse: collapse;
                        margin-top: 20px;
                    }

                    form {
                        margin-bottom: 20px;
                        margin-left: 30px;
                        padding-top: 25px;
                        font-size: 18px;
                        width: fit-content;
                        font-family: Arial, sans-serif;
                    }

                    select {
                        font-size: 17px;
                        margin-bottom: 20px;
                        margin-top: 10px;
                    }

                    input {
                        font-size: 17px;
                        margin-top: 10px;
                        margin-bottom: 20px;
                    }
                    .table th,
                    .table td {
                        padding: 8px;
                        border: 1px solid #ddd;
                        background-color: #e8e8e8;
                        text-align: center;
                    }

                    .table th {
                        background-color: #f2f2f2;
                    }
                </style>
                @if (Request.Method == "POST")
                {
                    string pokemonSeleccionado = Request.Form["cmbPokemons"];

                    if (!string.IsNullOrEmpty(pokemonSeleccionado))
                    {
                        Model.RellenarPoke(pokemonSeleccionado);
    
                        @foreach (var poke in Model.PokemonSeleccionado)
                        {
                            <table class="table">
                                <tr>
                                    <th>Número Pokedex</th>
                                    <th>Nombre</th>
                                    <th>Peso</th>
                                    <th>Altura</th>
                                </tr>
                                <tr>
                                    <td>@poke.NumeroPokedex</td>
                                    <td>@poke.Nombre</td>
                                    <td>@poke.Peso</td>
                                    <td>@poke.Altura</td>
                                </tr>
                            </table>
                        }
                    }
                }
            </fieldset>
        </form>
    </div>
}

